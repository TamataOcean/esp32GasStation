# DELETE OUTLIER DATA ( TEMPERATURE < -50 / CO2 > 10000 )
echo 'Begin process purge records'

# SELECT AVERRANT VALUE FOR CO2
echo 'Purge CO2 records'
curl -G 'http://localhost:8086/query?db=datagas' --data-urlencode "q=SELECT * FROM sensor WHERE CO2 > 10000" |  jq -r "(.results[0].series[0].values[][0])" >> delete_timestamps.txt


# SELECT AVERRANT VALUE FOR TEMPERATURE 
echo 'Purge Temperature records'
curl -G 'http://localhost:8086/query?db=datagas' --data-urlencode "q=select * from sensor where Temperature < -50" |  jq -r "(.results[0].series[0].values[][0])" >> delete_timestamps.txt

let " cpt = 0 "
for i in $(cat delete_timestamps.txt); do
  echo $i;
  curl -G 'http://localhost:8086/query?db=datagas' \
   --data-urlencode "q=DELETE FROM sensor WHERE time='$i'"; 
  let " cpt = cpt + 1 "
done
rm delete_timestamps.txt

echo 'End process : '  $cpt ' records purged'
